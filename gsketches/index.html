<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Sketches</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body { 
      font-family: system-ui; 
      background: var(--tg-theme-bg-color); 
      color: var(--tg-theme-text-color); 
      margin: 0;
      padding: 0;
    }
    
    .category-section {
      margin-bottom: 24px;
    }
    
    .category-title {
      font-size: 20px;
      font-weight: bold;
      padding: 16px 16px 8px 16px;
      margin: 0;
      color: var(--tg-theme-text-color);
      border-bottom: 2px solid var(--tg-theme-hint-color);
      opacity: 0.9;
    }
    
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
      gap: 12px; 
      padding: 16px; 
    }
    
    .sketch { 
      position: relative; 
      cursor: pointer; 
    }
    
    .thumb { 
      width: 100%; 
      border-radius: 12px; 
      filter: blur(8px); 
      transition: filter 0.3s; 
    }
    
    .unlocked .thumb { 
      filter: none; 
    }
    
    .price { 
      position: absolute; 
      bottom: 8px; 
      right: 8px; 
      background: rgba(0,0,0,0.7); 
      color: white; 
      padding: 4px 10px; 
      border-radius: 999px; 
      font-size: 12px; 
    }
    
    .no-items {
      padding: 20px;
      text-align: center;
      color: var(--tg-theme-hint-color);
      font-style: italic;
    }
  </style>
</head>
<body>
  <div id="ton-connect"></div>
  <button id="connect-btn" style="display:none;">Connect Wallet</button>

  <div id="gallery"></div>

  <script>
    // === CONFIG ===
    const YOUR_WALLET = "UQB8IVBFuiPlBBqvtIYfv-rfmn4Zh6d-NnDS6wbh1DTysPBX";   // â† CHANGE THIS
    
    // Categories definition with display order
    const CATEGORIES = [
      { id: "nigerians-africans", name: "ðŸ‡³ðŸ‡¬ Nigerians & Africans" },
      { id: "scientists", name: "ðŸ”¬ Scientists" },
      { id: "artists-entertainers", name: "ðŸŽ­ Artists & Entertainers" },
      { id: "freedom-fighters", name: "âœŠ Freedom Fighters" },
      { id: "sports-greats", name: "ðŸ† Sports Greats" },
      { id: "world-leaders", name: "ðŸŒ World Leaders" },
      { id: "legends", name: "â­ Legends" }
    ];

    const sketches = [
      // Nigerians & Africans
      { id: 2, title: "Ngozi Okonjo Iweala", thumb: "thumbs/2.jpg", full: "full/2.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 4, title: "Chief Obafemi Awolowo", thumb: "thumbs/4.jpg", full: "full/4.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 5, title: "Robert Mugabe #1", thumb: "thumbs/5.jpg", full: "full/5.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 9, title: "Kofi Annan", thumb: "thumbs/9.jpg", full: "full/9.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 10, title: "Miriam Makeba", thumb: "thumbs/10.jpg", full: "full/10.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 11, title: "Peter Obi", thumb: "thumbs/11.jpg", full: "full/11.jpg", price: "50000000", category: "nigerians-africans" },
      { id: 19, title: "Fela Anikulapo Kuti", thumb: "thumbs/19.jpg", full: "full/19.jpg", price: "50000000", category: "nigerians-africans" },
      
      // Scientists
      { id: 15, title: "Neil DeGrasse Tyson", thumb: "thumbs/15.jpg", full: "full/15.jpg", price: "50000000", category: "scientists" },
      
      // Artists & Entertainers
      { id: 1, title: "Ray Charles", thumb: "thumbs/1.jpg", full: "full/1.jpg", price: "50000000", category: "artists-entertainers" },
      { id: 6, title: "Fred Sanford (Redd Foxx)", thumb: "thumbs/6.jpg", full: "full/6.jpg", price: "50000000", category: "artists-entertainers" },
      { id: 12, title: "Bill Cosby", thumb: "thumbs/12.jpg", full: "full/12.jpg", price: "50000000", category: "artists-entertainers" },
      { id: 17, title: "Snoop Dogg", thumb: "thumbs/17.jpg", full: "full/17.jpg", price: "50000000", category: "artists-entertainers" },
      
      // Freedom Fighters
      { id: 18, title: "Nelson Mandela", thumb: "thumbs/18.jpg", full: "full/18.jpg", price: "50000000", category: "freedom-fighters" },
      
      // Sports Greats
      { id: 7, title: "Hulk Hogan", thumb: "thumbs/7.jpg", full: "full/7.jpg", price: "50000000", category: "sports-greats" },
      { id: 13, title: "Dwayne 'The Rock' Johnson", thumb: "thumbs/13.jpg", full: "full/13.jpg", price: "50000000", category: "sports-greats" },
      { id: 16, title: "Diego Maradona", thumb: "thumbs/16.jpg", full: "full/16.jpg", price: "50000000", category: "sports-greats" },
      
      // World Leaders
      { id: 20, title: "Dilalama", thumb: "thumbs/20.jpg", full: "full/20.jpg", price: "50000000", category: "world-leaders" },
      
      // Legends
      { id: 3, title: "E.T.", thumb: "thumbs/3.jpg", full: "full/3.jpg", price: "50000000", category: "legends" },
      { id: 8, title: "Danny DeVito", thumb: "thumbs/8.jpg", full: "full/8.jpg", price: "50000000", category: "legends" },
      { id: 14, title: "Jackie Chan", thumb: "thumbs/14.jpg", full: "full/14.jpg", price: "50000000", category: "legends" }
    ];

    // === TELEGRAM INIT ===
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // === TON CONNECT ===
    let tonConnectUI;
    const unlocked = JSON.parse(localStorage.getItem('unlocked') || '[]');

    async function initTON() {
      tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://georgeuwaifo75.github.io/gsketches/tonconnect-manifest.json',
        buttonRootId: 'ton-connect'
      });

      tonConnectUI.onStatusChange(wallet => {
        document.getElementById('connect-btn').style.display = wallet ? 'none' : 'block';
        renderGallery();
      });

      // manual connect button (optional)
      document.getElementById('connect-btn').onclick = () => tonConnectUI.connectWallet();
    }

    // === GALLERY ===
    function renderGallery() {
      const container = document.getElementById('gallery');
      container.innerHTML = '';

      // Group sketches by category
      const sketchesByCategory = {};
      CATEGORIES.forEach(cat => {
        sketchesByCategory[cat.id] = sketches.filter(sketch => sketch.category === cat.id);
      });

      // Render each category section
      CATEGORIES.forEach(category => {
        const categorySketches = sketchesByCategory[category.id];
        
        // Skip empty categories if you want, or show them with a message
        if (categorySketches.length === 0) return;

        // Create category section
        const section = document.createElement('div');
        section.className = 'category-section';
        
        // Add category title
        const title = document.createElement('h2');
        title.className = 'category-title';
        title.textContent = category.name;
        section.appendChild(title);
        
        // Create grid for this category
        const grid = document.createElement('div');
        grid.className = 'grid';
        
        // Add sketches to grid
        categorySketches.forEach(sketch => {
          const isUnlocked = unlocked.includes(sketch.id);
          const div = document.createElement('div');
          div.className = `sketch ${isUnlocked ? 'unlocked' : ''}`;
          div.innerHTML = `
            <img class="thumb" src="${sketch.thumb}" alt="${sketch.title}" loading="lazy">
            <div class="price">${(parseInt(sketch.price) / 1e9).toFixed(4)} TON</div>
          `;

          div.onclick = () => openSketch(sketch, isUnlocked);
          grid.appendChild(div);
        });
        
        section.appendChild(grid);
        container.appendChild(section);
      });
    }

    async function openSketch(sketch, isUnlocked) {
      if (isUnlocked) {
        showFull(sketch);
        return;
      }

      if (!tonConnectUI.account) {
        alert("Connect wallet first");
        return;
      }

      try {
        await tonConnectUI.sendTransaction({
          validUntil: Math.floor(Date.now() / 1000) + 300,
          messages: [{
            address: YOUR_WALLET,
            amount: sketch.price
          }]
        });

        // success â†’ unlock
        unlocked.push(sketch.id);
        localStorage.setItem('unlocked', JSON.stringify(unlocked));
        renderGallery();
        showFull(sketch);
      } catch (e) {
        console.error(e);
        // user cancelled or error
      }
    }

    function showFull(sketch) {
      // open in new tab or modal
      window.open(sketch.full, '_blank');
      // or create a nice modal with the full image
    }

    // === START ===
    initTON();
    renderGallery();
  </script>
</body>
</html>
